<?php
/**
 * Frontend Template for Site Banners Display
 * 
 * Version History:
 * V5.0.3: ViewModel Pattern - Template focuses on presentation only
 *         - Business logic moved to BannerViewModel
 *         - Template accesses data through $viewModel
 *         - Separation of concerns: presentation (template) vs business logic (ViewModel)
 *         - Improved testability and maintainability
 * 
 * V5.0.1: DI Fundamentals - Helper pattern introduced
 * V3.0.4: Page Builder content rendering
 * 
 * @var \Magento\Framework\View\Element\Template $block
 * @var \Vodacom\SiteBanners\ViewModel\BannerViewModel $viewModel
 */

// Get ViewModel from block arguments (injected via layout XML)
$viewModel = $block->getData('view_model');

if (!$viewModel) {
    return; // No ViewModel injected
}
?>

<div class="banner-page">
    <div class="banner-container">
        <header class="banner-header">
            <h1 class="banner-title"><?= __('Site Banners') ?></h1>
            <p class="banner-subtitle">
                <?= __('Active promotional banners with Page Builder content') ?>
            </p>
            <?php if ($viewModel->hasBanners()): ?>
                <p class="banner-count">
                    <?= __('Showing %1 active banner(s)', $viewModel->getActiveBannersCount()) ?>
                </p>
            <?php endif; ?>
        </header>
        
        <div class="banner-content">
            <?php if ($viewModel->hasBanners()): ?>
                <?php foreach ($viewModel->getActiveBanners() as $banner): ?>
                    <div class="<?= $block->escapeHtmlAttr($viewModel->getBannerCssClasses($banner)) ?>" 
                         data-banner-id="<?= $block->escapeHtmlAttr($banner->getBannerId()) ?>">
                        
                        <div class="banner-item-header">
                            <!-- Title with formatting from ViewModel -->
                            <h2 class="banner-item-title">
                                <?= $viewModel->getFormattedTitle($banner) ?>
                            </h2>
                        </div>
                        
                        <!-- Page Builder content (HTML safe from CMS filter) -->
                        <div class="banner-item-content">
                            <?= /* @noEscape */ $viewModel->getBannerContent($banner) ?>
                        </div>
                        
                        <?php if ($viewModel->hasDateRestrictions($banner)): ?>
                            <!-- Display date range if configured -->
                            <div class="banner-item-dates">
                                <?php if ($banner->getActiveFrom()): ?>
                                    <span class="banner-date-from">
                                        <?= __('From: %1', $block->escapeHtml($viewModel->formatDate($banner->getActiveFrom()))) ?>
                                    </span>
                                <?php endif; ?>
                                <?php if ($banner->getActiveTo()): ?>
                                    <span class="banner-date-to">
                                        <?= __('To: %1', $block->escapeHtml($viewModel->formatDate($banner->getActiveTo()))) ?>
                                    </span>
                                <?php endif; ?>
                            </div>
                        <?php endif; ?>
                        
                        <!-- Meta information -->
                        <div class="banner-meta">
                            <span class="banner-sort-order">
                                <?= __('Sort Order: %1', $block->escapeHtml($banner->getSortOrder())) ?>
                            </span>
                        </div>
                    </div>
                <?php endforeach; ?>
            <?php else: ?>
                <!-- Empty state when no active banners found -->
                <div class="banner-empty">
                    <p class="banner-empty-message">
                        <?= __('No active banners to display at this time.') ?>
                    </p>
                    <p class="banner-empty-help">
                        <?= __('Create banners in the admin panel: Vodacom > Site Banners') ?>
                    </p>
                </div>
            <?php endif; ?>
        </div>
        
        <footer class="banner-footer">
            <p class="banner-info">
                <?= __('Vodacom SiteBanners Module - Version 5.0.3 (ViewModel Pattern)') ?>
            </p>
            <p class="banner-stats">
                <?= __('Total Banners: %1', $viewModel->getTotalBannersCount()) ?>
            </p>
        </footer>
    </div>
</div>